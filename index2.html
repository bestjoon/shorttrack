<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‡¼íŠ¸íŠ¸ë™ ê¸°ë¡ History</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- ì„ ìˆ˜ ë°ì´í„° íŒŒì¼ ë¡œë“œ -->
    <script src="players_data.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px 0 rgba(31, 38, 135, 0.25);
        }
        .record-card {
            transition: all 0.2s ease;
        }
        .record-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        .badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .event-tab {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .event-tab:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        .event-tab.active {
            background-color: rgba(102, 126, 234, 0.2);
            border-bottom: 2px solid #667eea;
        }
        .upload-area {
            border: 2px dashed #667eea;
            transition: all 0.2s ease;
        }
        .upload-area:hover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.05);
        }
        .upload-area.dragover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            .glass-effect {
                box-shadow: 0 2px 8px 0 rgba(31, 38, 135, 0.2);
            }
            table {
                font-size: 12px;
            }
            .mobile-compact td, .mobile-compact th {
                padding: 6px 4px !important;
            }
            .mobile-hidden {
                display: none;
            }
            .mobile-text-sm {
                font-size: 11px;
            }
            .mobile-text-xs {
                font-size: 10px;
            }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function parseTime2000M(timeStr) {
            // 2000M ê¸°ë¡ì—ì„œ í¬ì¸íŠ¸ ì œê±°í•˜ê³  ì‹œê°„ë§Œ ì¶”ì¶œ
            // ì˜ˆ: "(15)03:53.692" -> "03:53.692"
            if (!timeStr) return null;
            
            const cleanedStr = String(timeStr).replace(/^\(\d+\)/, '');
            return cleanedStr;
        }

        function parseSheetData(jsonData) {
            // ì„ ìˆ˜ ì •ë³´ íŒŒì‹± (í–‰ 2-5)
            const playerInfo = {
                'ì´ë¦„': jsonData[2]?.[1] || '',
                'ì„±ë³„': jsonData[2]?.[3] || '',
                'ì¶œìƒë…„ë„': jsonData[3]?.[1] || '',
                'ì¢…ë³„': jsonData[3]?.[3] || '',
                'ì†Œì†íŒ€': jsonData[4]?.[1] || '',
                'ì‹œë„': jsonData[4]?.[3] || '',
                'ìµœì¢…ë“±ë¡ë…„ë„': jsonData[5]?.[1] || '',
                'ë“±ë¡êµ¬ë¶„': jsonData[5]?.[3] || ''
            };

            // ëŒ€íšŒ ê¸°ë¡ íŒŒì‹± (í–‰ 10ë¶€í„° ì‹œì‘)
            const competitions = [];
            let currentComp = null;
            let records = [];

            for (let i = 10; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length === 0) continue;
                
                // ëŒ€íšŒëª… í–‰ (ì²« ë²ˆì§¸ ì»¬ëŸ¼ì— ê°’ì´ ìˆê³  ë‘ ë²ˆì§¸ ì»¬ëŸ¼ì´ ì—†ëŠ” ê²½ìš°)
                if (row[0] && !row[1]) {
                    if (currentComp && records.length > 0) {
                        competitions.push({
                            name: currentComp,
                            records: records
                        });
                    }
                    currentComp = row[0];
                    records = [];
                }
                // ê¸°ë¡ í–‰ (ì¼ìê°€ ìˆ«ìì¸ ê²½ìš°)
                else if (typeof row[0] === 'number' && row[0] > 20000000) {
                    const record = {
                        'ì¼ì': String(row[0]),
                        'ì¢…ë³„': row[1] || '',
                        'ì„¸ë¶€ì¢…ëª©': row[2] || '',
                        'ë¼ìš´ë“œ': row[3] || '',
                        'ì†Œì†': row[4] || '',
                        'ê¸°ë¡': row[5] || '',
                        'ìˆœìœ„': row[6] || ''
                    };
                    records.push(record);
                }
            }

            // ë§ˆì§€ë§‰ ëŒ€íšŒ ì¶”ê°€
            if (currentComp && records.length > 0) {
                competitions.push({
                    name: currentComp,
                    records: records
                });
            }

            // ì—°ë„ë³„ ìµœê³  ê¸°ë¡ ê³„ì‚°
            const yearlyBest = {};
            const allEvents = new Set();

            const timeToSeconds = (timeStr) => {
                if (!timeStr || timeStr === '-' || timeStr === '') return null;
                
                // 2000M í¬ì¸íŠ¸ ì œê±°: "(15)03:53.692" -> "03:53.692"
                const cleanedStr = parseTime2000M(timeStr).trim();
                
                // ë‹¤ì–‘í•œ ì‹œê°„ í˜•ì‹ ì²˜ë¦¬
                // í˜•ì‹ 1: "00:01:23.456" ë˜ëŠ” "00:01:23.456000"
                let match = cleanedStr.match(/(\d{1,2}):(\d{2}):(\d{2})\.?(\d*)/);
                if (match) {
                    const hours = parseInt(match[1]) || 0;
                    const minutes = parseInt(match[2]) || 0;
                    const seconds = parseInt(match[3]) || 0;
                    const millisStr = match[4] || '0';
                    const milliseconds = parseInt(millisStr.substring(0, 3).padEnd(3, '0'));
                    return hours * 3600 + minutes * 60 + seconds + milliseconds / 1000;
                }
                
                // í˜•ì‹ 2: "01:23.456" (ë¶„:ì´ˆ.ë°€ë¦¬ì´ˆ)
                match = cleanedStr.match(/^(\d{1,2}):(\d{2})\.(\d+)$/);
                if (match) {
                    const minutes = parseInt(match[1]) || 0;
                    const seconds = parseInt(match[2]) || 0;
                    const millisStr = match[3] || '0';
                    const milliseconds = parseInt(millisStr.substring(0, 3).padEnd(3, '0'));
                    return minutes * 60 + seconds + milliseconds / 1000;
                }
                
                // í˜•ì‹ 3: "23.456" (ì´ˆ.ë°€ë¦¬ì´ˆ)
                match = cleanedStr.match(/^(\d{1,2})\.(\d+)$/);
                if (match) {
                    const seconds = parseInt(match[1]) || 0;
                    const millisStr = match[2] || '0';
                    const milliseconds = parseInt(millisStr.substring(0, 3).padEnd(3, '0'));
                    return seconds + milliseconds / 1000;
                }
                
                return null;
            };

            competitions.forEach(comp => {
                comp.records.forEach(record => {
                    const dateStr = record['ì¼ì'];
                    if (dateStr && dateStr.length >= 8) {
                        const year = dateStr.substring(0, 4);
                        const event = String(record['ì„¸ë¶€ì¢…ëª©']).toUpperCase();
                        const timeSeconds = timeToSeconds(record['ê¸°ë¡']);
                        
                        if (timeSeconds) {
                            allEvents.add(event);
                            
                            if (!yearlyBest[year]) {
                                yearlyBest[year] = {};
                            }
                            
                            if (!yearlyBest[year][event] || timeSeconds < yearlyBest[year][event].time) {
                                yearlyBest[year][event] = {
                                    time: timeSeconds,
                                    time_str: record['ê¸°ë¡'],
                                    competition: comp.name,
                                    date: dateStr,
                                    rank: record['ìˆœìœ„']
                                };
                            }
                        }
                    }
                });
            });

            return {
                player_info: playerInfo,
                yearly_best: yearlyBest,
                competitions: competitions,
                events: Array.from(allEvents).sort()
            };
        }

        function parseExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        console.log('Sheet names:', workbook.SheetNames);
                        
                        const allPlayers = {};
                        
                        // ëª¨ë“  ì‹œíŠ¸ ì½ê¸°
                        workbook.SheetNames.forEach(sheetName => {
                            const worksheet = workbook.Sheets[sheetName];
                            
                            // ì…€ì„ ì§ì ‘ ì½ì–´ì„œ í¬ë§· ìœ ì§€
                            const range = XLSX.utils.decode_range(worksheet['!ref']);
                            const jsonData = [];
                            
                            for (let R = range.s.r; R <= range.e.r; ++R) {
                                const row = [];
                                for (let C = range.s.c; C <= range.e.c; ++C) {
                                    const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
                                    const cell = worksheet[cellAddress];
                                    
                                    if (cell && cell.v !== undefined) {
                                        // ê¸°ë¡ ì»¬ëŸ¼(5ë²ˆ ì»¬ëŸ¼) íŠ¹ë³„ ì²˜ë¦¬
                                        if (C === 5) {
                                            if (typeof cell.v === 'string') {
                                                // ë¬¸ìì—´ì¸ ê²½ìš° (2000M í¬ì¸íŠ¸ ê¸°ë¡ ë“±)
                                                row[C] = cell.v;
                                            } else if (typeof cell.v === 'number' && cell.v < 1) {
                                                // Excelì˜ ì‹œê°„ ê°’ (í•˜ë£¨ì˜ ë¹„ìœ¨ë¡œ ì €ì¥ë¨)
                                                const totalSeconds = cell.v * 86400;
                                                const hours = Math.floor(totalSeconds / 3600);
                                                const minutes = Math.floor((totalSeconds % 3600) / 60);
                                                const seconds = Math.floor(totalSeconds % 60);
                                                const milliseconds = Math.round((totalSeconds % 1) * 1000);
                                                
                                                // ì‹œê°„ ë¬¸ìì—´ ìƒì„±
                                                row[C] = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}000`;
                                            } else if (cell.w && cell.w.includes(':')) {
                                                // ì´ë¯¸ ì‹œê°„ í˜•ì‹ìœ¼ë¡œ í¬ë§·ëœ ê²½ìš°
                                                row[C] = cell.w;
                                            } else if (cell.w && /^\d+\.\d+$/.test(cell.w)) {
                                                // "0138.6" ê°™ì€ í˜•ì‹ ì²˜ë¦¬
                                                const parts = cell.w.match(/^(\d+)(\d{2})\.(\d+)$/);
                                                if (parts) {
                                                    const minutes = parseInt(parts[1]);
                                                    const seconds = parseInt(parts[2]);
                                                    const decimal = parts[3];
                                                    row[C] = `00:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${decimal.padEnd(3, '0')}000`;
                                                } else {
                                                    // ì¼ë°˜ì ì¸ ì´ˆ.ë°€ë¦¬ì´ˆ í˜•ì‹
                                                    const totalSeconds = parseFloat(cell.w);
                                                    const minutes = Math.floor(totalSeconds / 60);
                                                    const seconds = Math.floor(totalSeconds % 60);
                                                    const milliseconds = Math.round((totalSeconds % 1) * 1000);
                                                    row[C] = `00:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}000`;
                                                }
                                            } else {
                                                row[C] = cell.w || cell.v;
                                            }
                                        } else {
                                            // ë‹¤ë¥¸ ì»¬ëŸ¼ë“¤
                                            row[C] = cell.w || cell.v;
                                        }
                                    } else {
                                        row[C] = null;
                                    }
                                }
                                jsonData.push(row);
                            }
                            
                            const parsedData = parseSheetData(jsonData);
                            parsedData.sheetName = sheetName;
                            
                            // ì´ë¦„ì´ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
                            const playerName = parsedData.player_info['ì´ë¦„'];
                            if (playerName && playerName.trim()) {
                                allPlayers[playerName] = parsedData;
                            }
                        });
                        
                        resolve(allPlayers);
                    } catch (error) {
                        console.error('Error parsing Excel:', error);
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function App() {
            const [playersData, setPlayersData] = useState(null);
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [selectedEvent, setSelectedEvent] = useState('ALL');
            const [selectedYear, setSelectedYear] = useState('ALL');
            const [loading, setLoading] = useState(true);
            const [uploadStatus, setUploadStatus] = useState('');
            const [dragOver, setDragOver] = useState(false);
            const [dataSource, setDataSource] = useState('default'); // 'default' or 'uploaded'
            const [originalDefaultData, setOriginalDefaultData] = useState(null);

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                function loadDefaultData() {
                    // ì „ì—­ ë³€ìˆ˜ì—ì„œ ë°ì´í„° í™•ì¸
                    if (typeof defaultPlayersData !== 'undefined') {
                        setOriginalDefaultData(defaultPlayersData);
                        setPlayersData(defaultPlayersData);
                        
                        // ì²« ë²ˆì§¸ ì„ ìˆ˜ ìë™ ì„ íƒ
                        const firstPlayer = Object.keys(defaultPlayersData)[0];
                        if (firstPlayer) {
                            setSelectedPlayer(firstPlayer);
                        }
                        setDataSource('default');
                        setLoading(false);
                        setUploadStatus('');
                    } else {
                        // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                        const handleDataLoaded = () => {
                            if (typeof defaultPlayersData !== 'undefined') {
                                setOriginalDefaultData(defaultPlayersData);
                                setPlayersData(defaultPlayersData);
                                
                                const firstPlayer = Object.keys(defaultPlayersData)[0];
                                if (firstPlayer) {
                                    setSelectedPlayer(firstPlayer);
                                }
                                setDataSource('default');
                                setLoading(false);
                                setUploadStatus('');
                            }
                        };
                        
                        window.addEventListener('playersDataLoaded', handleDataLoaded);
                        
                        // 3ì´ˆ í›„ì—ë„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                        setTimeout(() => {
                            if (loading) {
                                setUploadStatus('ê¸°ë³¸ ë°ì´í„° íŒŒì¼(players_data.js)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                                setLoading(false);
                            }
                        }, 3000);
                        
                        return () => {
                            window.removeEventListener('playersDataLoaded', handleDataLoaded);
                        };
                    }
                }
                
                loadDefaultData();
            }, []);

            const handleFileInput = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    await handleFile(file);
                }
            };

            const handleFile = async (file) => {
                if (!file.name.match(/\.(xlsx|xls)$/)) {
                    setUploadStatus('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }

                setLoading(true);
                setUploadStatus('íŒŒì¼ ì²˜ë¦¬ ì¤‘...');
                
                try {
                    const parsedData = await parseExcelFile(file);
                    setPlayersData(parsedData);
                    setDataSource('uploaded');
                    
                    const firstPlayer = Object.keys(parsedData)[0];
                    if (firstPlayer) {
                        setSelectedPlayer(firstPlayer);
                    }
                    
                    setUploadStatus(`${Object.keys(parsedData).length}ëª…ì˜ ì„ ìˆ˜ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);
                } catch (error) {
                    console.error('File processing error:', error);
                    setUploadStatus('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setLoading(false);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setDragOver(false);
            };

            const handleDrop = async (e) => {
                e.preventDefault();
                setDragOver(false);
                
                const file = e.dataTransfer.files[0];
                if (file) {
                    await handleFile(file);
                }
            };

            const handleSaveAsJSON = () => {
                if (playersData) {
                    const filename = dataSource === 'uploaded' ? 'players_data_converted.json' : 'players_data.json';
                    downloadJSON(playersData, filename);
                    setUploadStatus('JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            };

            const handleResetToDefault = () => {
                if (originalDefaultData) {
                    setPlayersData(originalDefaultData);
                    setDataSource('default');
                    const firstPlayer = Object.keys(originalDefaultData)[0];
                    if (firstPlayer) {
                        setSelectedPlayer(firstPlayer);
                    }
                    setUploadStatus('ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            };

            const formatTime = (seconds) => {
                if (!seconds) return '-';
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toFixed(3).padStart(6, '0')}`;
            };

            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                if (dateStr.length === 8) {
                    return `${dateStr.substring(0, 4)}.${dateStr.substring(4, 6)}.${dateStr.substring(6, 8)}`;
                }
                return dateStr;
            };

            const calculateImprovement = (currentTime, previousTime) => {
                if (!currentTime || !previousTime) return null;
                const diff = previousTime - currentTime;
                return diff > 0 ? `â–¼ ${diff.toFixed(3)}s` : null;
            };

            const getEventStats = (playerData, event) => {
                const times = [];
                Object.entries(playerData.yearly_best || {}).forEach(([year, events]) => {
                    if (events[event]) {
                        times.push({
                            year,
                            time: events[event].time,
                            rank: events[event].rank
                        });
                    }
                });
                
                if (times.length === 0) return null;
                
                times.sort((a, b) => a.time - b.time);
                const best = times[0];
                const latest = times[times.length - 1];
                const average = times.reduce((acc, t) => acc + t.time, 0) / times.length;
                
                return {
                    best: best.time,
                    bestYear: best.year,
                    latest: latest.time,
                    latestYear: latest.year,
                    average,
                    count: times.length
                };
            };

            const currentPlayerData = playersData && selectedPlayer ? playersData[selectedPlayer] : null;
            const availableYears = currentPlayerData ? 
                [...new Set(Object.keys(currentPlayerData.yearly_best || {}))].sort((a, b) => b - a) : [];
            const availableEvents = currentPlayerData ? 
                (currentPlayerData.events || []) : [];

            // í•„í„°ë§ëœ ì—°ë„ ëª©ë¡
            const displayYears = selectedYear === 'ALL' ? availableYears : [selectedYear];

            return (
                <div className="min-h-screen py-4 px-2 md:py-8 md:px-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="glass-effect rounded-lg p-4 md:p-8 mb-6">
                            <h1 className="text-2xl md:text-4xl font-bold text-gray-800 mb-4 text-center">
                                ğŸ ì‡¼íŠ¸íŠ¸ë™ ê¸°ë¡ History ğŸ†
                            </h1>
                            
                            {/* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */}
                            <div className="mb-6">
                                <div 
                                    className={`upload-area p-6 rounded-lg text-center ${dragOver ? 'dragover' : ''}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                >
                                    <input
                                        type="file"
                                        accept=".xlsx,.xls"
                                        onChange={handleFileInput}
                                        className="hidden"
                                        id="file-input"
                                    />
                                    <label 
                                        htmlFor="file-input" 
                                        className="cursor-pointer inline-block px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all"
                                    >
                                        ì—‘ì…€ íŒŒì¼ ì„ íƒ
                                    </label>
                                    <p className="mt-2 text-gray-600 text-sm">
                                        ë˜ëŠ” íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”
                                    </p>
                                </div>
                                
                                {uploadStatus && (
                                    <div className={`mt-2 p-2 rounded text-sm ${
                                        uploadStatus.includes('ì˜¤ë¥˜') || uploadStatus.includes('ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤') 
                                            ? 'bg-red-100 text-red-700' 
                                            : 'bg-green-100 text-green-700'
                                    }`}>
                                        {uploadStatus}
                                    </div>
                                )}
                                
                                {/* ë°ì´í„° ê´€ë¦¬ ë²„íŠ¼ */}
                                <div className="mt-4 flex flex-wrap gap-2 justify-center">
                                    {playersData && (
                                        <button
                                            onClick={handleSaveAsJSON}
                                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all text-sm"
                                        >
                                            ğŸ“¥ JSONìœ¼ë¡œ ì €ì¥
                                        </button>
                                    )}
                                    {originalDefaultData && dataSource === 'uploaded' && (
                                        <button
                                            onClick={handleResetToDefault}
                                            className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all text-sm"
                                        >
                                            ğŸ”„ ê¸°ë³¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                                        </button>
                                    )}
                                    {dataSource === 'uploaded' && (
                                        <span className="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm">
                                            ğŸ“Š ì—…ë¡œë“œëœ ë°ì´í„° ì‚¬ìš© ì¤‘
                                        </span>
                                    )}
                                </div>
                            </div>

                            {loading && <div className="loader"></div>}

                            {!loading && playersData && (
                                <>
                                    {/* ì„ ìˆ˜ ì„ íƒ ë²„íŠ¼ */}
                                    <div className="mb-6">
                                        <h2 className="text-lg font-semibold mb-3 text-gray-700">ì„ ìˆ˜ ì„ íƒ</h2>
                                        <div className="flex flex-wrap gap-2">
                                            {Object.keys(playersData).map(playerName => (
                                                <button
                                                    key={playerName}
                                                    onClick={() => setSelectedPlayer(playerName)}
                                                    className={`px-3 py-2 rounded-lg transition-all text-sm ${
                                                        selectedPlayer === playerName
                                                            ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white'
                                                            : 'bg-white text-gray-700 hover:bg-gray-100'
                                                    }`}
                                                >
                                                    {playerName}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* ì„ ìˆ˜ ì •ë³´ ë° ê¸°ë¡ í‘œì‹œ */}
                                    {currentPlayerData && (
                                        <>
                                            {/* ì„ ìˆ˜ ì •ë³´ ì¹´ë“œ */}
                                            <div className="mb-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4">
                                                <h2 className="text-xl font-bold mb-3 text-gray-800">
                                                    {currentPlayerData.player_info['ì´ë¦„']} ì„ ìˆ˜ ì •ë³´
                                                </h2>
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                    <div>
                                                        <span className="text-gray-600">ì„±ë³„:</span>
                                                        <span className="ml-2 font-semibold">{currentPlayerData.player_info['ì„±ë³„']}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-600">ì¶œìƒë…„ë„:</span>
                                                        <span className="ml-2 font-semibold">{currentPlayerData.player_info['ì¶œìƒë…„ë„']}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-600">ì¢…ë³„:</span>
                                                        <span className="ml-2 font-semibold">{currentPlayerData.player_info['ì¢…ë³„']}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-600">ì†Œì†íŒ€:</span>
                                                        <span className="ml-2 font-semibold">{currentPlayerData.player_info['ì†Œì†íŒ€']}</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ì¢…ëª© ë° ì—°ë„ í•„í„° */}
                                            <div className="mb-4 space-y-4">
                                                <div>
                                                    <h3 className="text-sm font-semibold mb-2 text-gray-600">ì¢…ëª©ë³„ í•„í„°</h3>
                                                    <div className="flex flex-wrap gap-2">
                                                        <button
                                                            onClick={() => setSelectedEvent('ALL')}
                                                            className={`px-3 py-1 rounded text-xs event-tab ${
                                                                selectedEvent === 'ALL' ? 'active' : ''
                                                            }`}
                                                        >
                                                            ì „ì²´
                                                        </button>
                                                        {availableEvents.map(event => (
                                                            <button
                                                                key={event}
                                                                onClick={() => setSelectedEvent(event)}
                                                                className={`px-3 py-1 rounded text-xs event-tab ${
                                                                    selectedEvent === event ? 'active' : ''
                                                                }`}
                                                            >
                                                                {event}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>

                                                <div>
                                                    <h3 className="text-sm font-semibold mb-2 text-gray-600">ì—°ë„ë³„ í•„í„°</h3>
                                                    <div className="flex flex-wrap gap-2">
                                                        <button
                                                            onClick={() => setSelectedYear('ALL')}
                                                            className={`px-3 py-1 rounded text-xs event-tab ${
                                                                selectedYear === 'ALL' ? 'active' : ''
                                                            }`}
                                                        >
                                                            ì „ì²´
                                                        </button>
                                                        {availableYears.map(year => (
                                                            <button
                                                                key={year}
                                                                onClick={() => setSelectedYear(year)}
                                                                className={`px-3 py-1 rounded text-xs event-tab ${
                                                                    selectedYear === year ? 'active' : ''
                                                                }`}
                                                            >
                                                                {year}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ì—°ë„ë³„ ìµœê³  ê¸°ë¡ */}
                                            <div className="mb-6">
                                                <h3 className="text-lg font-bold mb-3 text-gray-800">ì—°ë„ë³„ ìµœê³  ê¸°ë¡</h3>
                                                {displayYears.map(year => {
                                                    const yearData = currentPlayerData.yearly_best[year];
                                                    if (!yearData) return null;

                                                    const filteredEvents = selectedEvent === 'ALL' 
                                                        ? Object.keys(yearData)
                                                        : Object.keys(yearData).filter(e => e === selectedEvent);

                                                    if (filteredEvents.length === 0) return null;

                                                    return (
                                                        <div key={year} className="mb-4 record-card bg-white rounded-lg p-4">
                                                            <h4 className="font-semibold text-purple-600 mb-2">{year}ë…„</h4>
                                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                                                {filteredEvents.sort().map(event => {
                                                                    const record = yearData[event];
                                                                    const prevYear = String(parseInt(year) - 1);
                                                                    const prevRecord = currentPlayerData.yearly_best[prevYear]?.[event];
                                                                    const improvement = calculateImprovement(record.time, prevRecord?.time);
                                                                    
                                                                    return (
                                                                        <div key={event} className="bg-gray-50 rounded p-3">
                                                                            <div className="flex justify-between items-start mb-1">
                                                                                <span className="font-semibold text-blue-600">{event}</span>
                                                                                {record.rank === 1 && <span className="badge text-xs">ğŸ¥‡</span>}
                                                                                {record.rank === 2 && <span className="badge text-xs">ğŸ¥ˆ</span>}
                                                                                {record.rank === 3 && <span className="badge text-xs">ğŸ¥‰</span>}
                                                                            </div>
                                                                            <div className="text-xl font-bold text-gray-800">
                                                                                {formatTime(record.time)}
                                                                            </div>
                                                                            {improvement && (
                                                                                <div className="text-xs text-green-600 mt-1">
                                                                                    {improvement}
                                                                                </div>
                                                                            )}
                                                                            <div className="text-xs text-gray-600 mt-2">
                                                                                <div>{record.competition}</div>
                                                                                <div>{formatDate(record.date)}</div>
                                                                            </div>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>

                                            {/* ì¢…ëª©ë³„ í†µê³„ */}
                                            {selectedEvent !== 'ALL' && (
                                                <div className="mb-6 bg-yellow-50 rounded-lg p-4">
                                                    <h3 className="text-lg font-bold mb-3 text-gray-800">
                                                        {selectedEvent} í†µê³„
                                                    </h3>
                                                    {(() => {
                                                        const stats = getEventStats(currentPlayerData, selectedEvent);
                                                        if (!stats) return <p className="text-gray-600">ê¸°ë¡ ì—†ìŒ</p>;
                                                        
                                                        return (
                                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                                <div>
                                                                    <div className="text-gray-600">ìµœê³  ê¸°ë¡</div>
                                                                    <div className="font-bold text-lg">{formatTime(stats.best)}</div>
                                                                    <div className="text-xs text-gray-500">({stats.bestYear}ë…„)</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-600">ìµœê·¼ ê¸°ë¡</div>
                                                                    <div className="font-bold text-lg">{formatTime(stats.latest)}</div>
                                                                    <div className="text-xs text-gray-500">({stats.latestYear}ë…„)</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-600">í‰ê·  ê¸°ë¡</div>
                                                                    <div className="font-bold text-lg">{formatTime(stats.average)}</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-600">ì´ ì°¸ê°€</div>
                                                                    <div className="font-bold text-lg">{stats.count}íšŒ</div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                            )}

                                            {/* ëŒ€íšŒë³„ ìƒì„¸ ê¸°ë¡ */}
                                            <div className="mb-6">
                                                <h3 className="text-lg font-bold mb-3 text-gray-800">ëŒ€íšŒë³„ ìƒì„¸ ê¸°ë¡</h3>
                                                <div className="overflow-x-auto">
                                                    <table className="w-full text-left mobile-compact">
                                                        <thead>
                                                            <tr className="bg-gray-100">
                                                                <th className="p-2 mobile-text-xs">ëŒ€íšŒëª…</th>
                                                                <th className="p-2 mobile-text-xs">ì¼ì</th>
                                                                <th className="p-2 mobile-text-xs">ì¢…ëª©</th>
                                                                <th className="p-2 mobile-text-xs mobile-hidden">ë¼ìš´ë“œ</th>
                                                                <th className="p-2 mobile-text-xs">ê¸°ë¡</th>
                                                                <th className="p-2 mobile-text-xs">ìˆœìœ„</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {currentPlayerData.competitions.map((comp, compIdx) => {
                                                                const filteredRecords = comp.records.filter(record => {
                                                                    const yearMatch = selectedYear === 'ALL' || 
                                                                        record['ì¼ì'].substring(0, 4) === selectedYear;
                                                                    const eventMatch = selectedEvent === 'ALL' || 
                                                                        String(record['ì„¸ë¶€ì¢…ëª©']).toUpperCase() === selectedEvent;
                                                                    return yearMatch && eventMatch;
                                                                });

                                                                if (filteredRecords.length === 0) return null;

                                                                return filteredRecords.map((record, idx) => (
                                                                    <tr key={`${compIdx}-${idx}`} className="border-b hover:bg-gray-50">
                                                                        <td className="p-2 mobile-text-xs">{comp.name}</td>
                                                                        <td className="p-2 mobile-text-xs">{formatDate(record['ì¼ì'])}</td>
                                                                        <td className="p-2 mobile-text-xs font-semibold">{record['ì„¸ë¶€ì¢…ëª©']}</td>
                                                                        <td className="p-2 mobile-text-xs mobile-hidden">{record['ë¼ìš´ë“œ']}</td>
                                                                        <td className="p-2 mobile-text-xs font-mono">{record['ê¸°ë¡']}</td>
                                                                        <td className="p-2 mobile-text-xs">
                                                                            {record['ìˆœìœ„'] === 1 && 'ğŸ¥‡'}
                                                                            {record['ìˆœìœ„'] === 2 && 'ğŸ¥ˆ'}
                                                                            {record['ìˆœìœ„'] === 3 && 'ğŸ¥‰'}
                                                                            {record['ìˆœìœ„'] && ` ${record['ìˆœìœ„']}ìœ„`}
                                                                        </td>
                                                                    </tr>
                                                                ));
                                                            })}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
